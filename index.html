<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS VTT // ORDEAL RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --accent: #7000ff; --bg: #02050a; --card: #0d1117; --red: #ff3e3e; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; height: 100vh; display: grid; grid-template-columns: 320px 1fr 280px; overflow: hidden; }

        /* Estilização Geral de Painéis */
        header { grid-column: 1 / -1; background: #000; border-bottom: 1px solid var(--neon); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        h1 { font-family: 'Orbitron'; font-size: 18px; margin: 0; color: var(--neon); letter-spacing: 2px; }
        aside, main { height: calc(100vh - 50px); overflow-y: auto; padding: 15px; border-right: 1px solid rgba(0,242,255,0.1); }

        /* Ficha de Personagem (Esquerda) */
        .stat-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--card); border: 1px solid #333; padding: 10px; border-radius: 5px; text-align: center; }
        .stat-card label { font-size: 10px; color: var(--neon); display: block; font-family: 'Orbitron'; }
        .stat-card input { background: transparent; border: none; color: #fff; font-size: 20px; width: 100%; text-align: center; font-weight: bold; }
        
        .resource-bar { background: #1a1a1a; border-radius: 3px; height: 8px; margin-top: 5px; overflow: hidden; }
        .bar-fill { height: 100%; transition: 0.3s; }

        .skills-container h3 { font-family: 'Orbitron'; font-size: 12px; border-bottom: 1px solid var(--accent); padding-bottom: 5px; margin-top: 15px; }
        .skill-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; background: rgba(255,255,255,0.03); padding: 5px 8px; border-radius: 4px; font-size: 13px; }
        .skill-row button { background: transparent; border: 1px solid var(--neon); color: var(--neon); border-radius: 3px; cursor: pointer; font-size: 10px; padding: 2px 6px; }
        .skill-row button:hover { background: var(--neon); color: #000; }

        /* Área do Mapa (Centro) */
        #viewport { background: #000; position: relative; cursor: crosshair; overflow: hidden; }
        #map-img { width: 100%; height: 100%; object-fit: contain; }
        #fog { position: absolute; top:0; left:0; pointer-events: auto; }

        /* Log e Controles (Direita) */
        .log-box { background: #000; border: 1px solid #222; height: 300px; overflow-y: auto; padding: 10px; font-family: monospace; font-size: 12px; color: #aaa; margin-bottom: 15px; border-radius: 5px; }
        .log-entry { margin-bottom: 8px; border-left: 2px solid var(--accent); padding-left: 8px; }
        .critical { color: #ffdb15; font-weight: bold; }

        button.action-btn { background: var(--accent); color: #fff; border: none; padding: 12px; width: 100%; border-radius: 5px; font-family: 'Orbitron'; font-size: 12px; cursor: pointer; margin-bottom: 10px; }
        button.action-btn:hover { filter: brightness(1.2); box-shadow: 0 0 10px var(--accent); }
    </style>
</head>
<body>

<header>
    <h1>NEXUS VTT // CORE SYSTEM</h1>
    <div style="font-size: 12px; color: #666;">MODO: MESTRE DE JOGO</div>
</header>

<aside>
    <div class="stat-group">
        <div class="stat-card">
            <label>CORPO</label>
            <input type="number" id="attr-corpo" value="5" onchange="updateResources()">
        </div>
        <div class="stat-card">
            <label>MENTE</label>
            <input type="number" id="attr-mente" value="3">
        </div>
        <div class="stat-card">
            <label>ALMA</label>
            <input type="number" id="attr-alma" value="2" onchange="updateResources()">
        </div>
    </div>

    <div class="card" style="margin-bottom:20px;">
        <div style="display:flex; justify-content:space-between; font-size:12px;">
            <span>PV: <b id="pv-val">15/15</b></span>
            <span>MANA: <b id="mana-val">4/4</b></span>
            <span>DEF: <b id="def-val">10</b></span>
        </div>
        <div class="resource-bar"><div id="pv-bar" class="bar-fill" style="width:100%; background:var(--red);"></div></div>
        <div class="resource-bar"><div id="mana-bar" class="bar-fill" style="width:100%; background:var(--neon);"></div></div>
    </div>

    <div class="skills-container">
        <h3>PERÍCIAS DE CORPO</h3>
        <div id="skills-corpo"></div>
        
        <h3>PERÍCIAS DE MENTE</h3>
        <div id="skills-mente"></div>

        <h3>PERÍCIAS DE ALMA</h3>
        <div id="skills-alma"></div>
    </div>
</aside>

<main id="viewport">
    <img id="map-img" src="">
    <canvas id="fog"></canvas>
</main>

<aside style="border-right:none; border-left:1px solid rgba(0,242,255,0.1);">
    <h3 style="font-family:'Orbitron'; font-size:12px; color:var(--neon);">LOG DE AÇÕES</h3>
    <div id="log" class="log-box"></div>

    <button class="action-btn" onclick="document.getElementById('map-upload').click()">CARREGAR MAPA</button>
    <input type="file" id="map-upload" style="display:none" accept="image/*">
    
    <button class="action-btn" style="background:#333;" onclick="resetFog()">REPOR NÉVOA</button>
    
    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:5px;">
        <small style="color:#666;">DICA: Use o mouse no mapa para revelar a área. O sistema calcula sucessos com base no d20[cite: 11].</small>
    </div>
</aside>

<script>
    const log = document.getElementById('log');
    const canvas = document.getElementById('fog');
    const ctx = canvas.getContext('2d');

    // Listas de Perícias Baseadas nos PDFs 
    const skillList = {
        corpo: ["Luta", "Pontaria", "Acrobacia", "Atletismo", "Furtividade", "Resistência Física"],
        mente: ["Investigação", "Medicina", "Persuasão", "Enganação", "Tecnologia", "Saber Conhecimento"],
        alma: ["Manifestação de Poder", "Percepção", "Intuição", "Vontade", "Determinação"]
    };

    function initSkills() {
        for (let cat in skillList) {
            const container = document.getElementById(`skills-${cat}`);
            skillList[cat].forEach(s => {
                container.innerHTML += `
                    <div class="skill-row">
                        <span>${s}</span>
                        <div>
                            <input type="number" value="0" style="width:30px; background:none; border:none; color:var(--neon); text-align:right;" id="skill-${s}">
                            <button onclick="rollSkill('${s}', '${cat}')">D20</button>
                        </div>
                    </div>`;
            });
        }
    }

    // Lógica de Recursos 
    function updateResources() {
        const corpo = parseInt(document.getElementById('attr-corpo').value) || 0;
        const alma = parseInt(document.getElementById('attr-alma').value) || 0;
        const acrobacia = parseInt(document.getElementById('skill-Acrobacia').value) || 0;

        const maxPV = corpo + 10;
        const maxMana = alma * 2;
        const def = 10 + Math.floor(corpo/2) + acrobacia; // Modificador base simplificado

        document.getElementById('pv-val').innerText = `${maxPV}/${maxPV}`;
        document.getElementById('mana-val').innerText = `${maxMana}/${maxMana}`;
        document.getElementById('def-val').innerText = def;
    }

    // Lógica de Rolagem d20 [cite: 11, 13, 14]
    function rollSkill(name, attrType) {
        const bonus = parseInt(document.getElementById(`skill-${name}`).value) || 0;
        const d20 = Math.floor(Math.random() * 20) + 1;
        const total = d20 + bonus;
        
        let msg = `<div class="log-entry"><b>${name.toUpperCase()}</b>: Rolou ${d20} + ${bonus} = <b>${total}</b>`;
        if(d20 === 20) msg += ` <span class="critical">[CRÍTICO!]</span>`;
        if(d20 === 1) msg += ` <span style="color:red">[FALHA!]</span>`;
        msg += `</div>`;
        
        log.innerHTML = msg + log.innerHTML;
    }

    // Mapa e Névoa
    document.getElementById('map-upload').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            document.getElementById('map-img').src = ev.target.result;
            setTimeout(resetFog, 200);
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function resetFog() {
        canvas.width = document.getElementById('viewport').clientWidth;
        canvas.height = document.getElementById('viewport').clientHeight;
        ctx.fillStyle = "#050b14";
        ctx.fillRect(0,0, canvas.width, canvas.height);
    }

    let drawing = false;
    canvas.onmousedown = () => drawing = true;
    window.onmouseup = () => drawing = false;
    canvas.onmousemove = (e) => {
        if(!drawing) return;
        const rect = canvas.getBoundingClientRect();
        ctx.globalCompositeOperation = 'destination-out';
        ctx.beginPath();
        ctx.arc(e.clientX - rect.left, e.clientY - rect.top, 45, 0, Math.PI*2);
        ctx.fill();
    }

    initSkills();
    updateResources();
</script>

</body>
</html>
