// --- ADICIONE ESTE BLOCO DENTRO DA SUA TAG <SCRIPT> ---

let zoom = 1;
const viewport = document.getElementById('viewport');
const mapArea = document.getElementById('map-area');

// 1. ZOOM COM O SCROLL DO MOUSE
viewport.addEventListener('wheel', (e) => {
    e.preventDefault();
    const delta = e.deltaY > 0 ? -0.1 : 0.1;
    zoom = Math.min(Math.max(0.2, zoom + delta), 3); // Limita zoom entre 0.2x e 3x
    mapArea.style.transform = `scale(${zoom})`;
}, { passive: false });

// 2. ARRASTAR O MAPA (PAN) COM O BOTÃO DIREITO
let isPanning = false;
let startX, startY, scrollLeft, scrollTop;

viewport.addEventListener('mousedown', (e) => {
    if (e.button === 2) { // Botão direito
        isPanning = true;
        startX = e.pageX - viewport.offsetLeft;
        startY = e.pageY - viewport.offsetTop;
        scrollLeft = viewport.scrollLeft;
        scrollTop = viewport.scrollTop;
    }
});

viewport.addEventListener('mousemove', (e) => {
    if (!isPanning) return;
    e.preventDefault();
    const x = e.pageX - viewport.offsetLeft;
    const y = e.pageY - viewport.offsetTop;
    const walkX = (x - startX);
    const walkY = (y - startY);
    viewport.scrollLeft = scrollLeft - walkX;
    viewport.scrollTop = scrollTop - walkY;
});

window.addEventListener('mouseup', () => isPanning = false);

// Desativa o menu de contexto padrão no mapa para não atrapalhar o Pan
viewport.addEventListener('contextmenu', e => e.preventDefault());

// 3. ATALHOS DE TECLADO
window.addEventListener('keydown', (e) => {
    if (!active) return;
    
    // Deletar com a tecla Delete
    if (e.key === "Delete") del();
    
    // Flip com a tecla F
    if (e.key.toLowerCase() === "f") flip();
    
    // Movimento fino com as setas
    const step = 5;
    if (e.key === "ArrowUp") active.style.top = (parseInt(active.style.top) - step) + "px";
    if (e.key === "ArrowDown") active.style.top = (parseInt(active.style.top) + step) + "px";
    if (e.key === "ArrowLeft") active.style.left = (parseInt(active.style.left) - step) + "px";
    if (e.key === "ArrowRight") active.style.left = (parseInt(active.style.left) + step) + "px";
});
