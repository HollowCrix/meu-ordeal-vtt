<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS HUB // ORDEAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --bg: #010409; --panel: #0d1117; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; height: 100vh; overflow: hidden; display: flex; }
        
        /* Menu Lateral (Escondido em telas pequenas se quiseres, mas mantemos os √≠cones) */
        nav { width: 60px; background: #000; border-right: 1px solid var(--neon); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; z-index: 1000; flex-shrink: 0; }
        .nav-btn { font-size: 20px; cursor: pointer; opacity: 0.5; }
        .nav-btn.active { opacity: 1; color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        main { flex: 1; position: relative; display: flex; flex-direction: column; min-width: 0; }
        .tab-content { display: none; width: 100%; height: 100%; }
        .tab-content.active { display: flex; }

        /* Area do Mapa */
        #vp { flex: 1; background: #000; position: relative; overflow: hidden; touch-action: none; }
        #map-display { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        #fog-canvas { position: absolute; top: 0; left: 0; z-index: 10; opacity: 0.8; }
        
        /* Painel Lateral Responsivo */
        .side-ui { width: 260px; background: var(--panel); border-left: 1px solid rgba(0,242,255,0.2); display: flex; flex-direction: column; padding: 10px; gap: 10px; overflow-y: auto; flex-shrink: 0; }
        
        /* Ajuste para Celular */
        @media (max-width: 768px) {
            .side-ui { display: none; } /* Esconde o painel no celular para focar no mapa */
            .show-menu .side-ui { display: flex; position: absolute; right: 0; height: 100%; z-index: 2000; width: 80%; }
        }

        .token { position: absolute; border-radius: 50%; border: 2px solid var(--neon); background-size: cover; background-position: center; z-index: 100; box-shadow: 0 0 10px #000; touch-action: none; }
        .token-small { width: 40px; height: 40px; }
        .token-medium { width: 60px; height: 60px; }
        .token-large { width: 90px; height: 90px; }
        
        button { background: var(--neon); border: none; padding: 8px; border-radius: 4px; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; font-size: 10px; }
        input, select { background: #000; border: 1px solid #333; color: #fff; padding: 5px; font-size: 12px; }
    </style>
</head>
<body id="body-tag">

<nav>
    <div class="nav-btn active" onclick="openTab('home', this)">üè†</div>
    <div class="nav-btn" onclick="openTab('game', this)">‚öîÔ∏è</div>
    <div class="nav-btn" onclick="document.getElementById('body-tag').classList.toggle('show-menu')">‚öôÔ∏è</div>
</nav>

<main>
    <div id="home" class="tab-content active" style="padding:20px; flex-direction: column;">
        <h1 style="color:var(--neon); font-family:'Orbitron';">NEXUS HUB</h1>
        <p>Acesse a aba ‚öîÔ∏è para o Tabletop.</p>
        <button onclick="openTab('game', document.querySelectorAll('.nav-btn')[1])">ENTRAR NA MESA</button>
    </div>

    <div id="game" class="tab-content">
        <div id="vp">
            <img id="map-display" src="">
            <canvas id="fog-canvas"></canvas>
        </div>
        <aside class="side-ui">
            <h3 style="color:var(--neon); font-size:12px;">GERADOR DE TOKEN</h3>
            <input type="file" id="tk-img" accept="image/*">
            <select id="tk-size">
                <option value="token-small">Pequeno</option>
                <option value="token-medium" selected>M√©dio</option>
                <option value="token-large">Grande</option>
            </select>
            <hr style="border:0; border-top:1px solid #222; width:100%;">
            <h3 style="color:var(--neon); font-size:12px;">MAPA</h3>
            <input type="file" id="map-in" accept="image/*">
            <button onclick="clearFog()">LIMPAR TUDO</button>
            <button onclick="resetFog()" style="background:#333; color:#ccc;">COBRIR TUDO</button>
        </aside>
    </div>
</main>

<script>
    const vp = document.getElementById('vp');
    const canvas = document.getElementById('fog-canvas');
    const ctx = canvas.getContext('2d');
    let currentTokenImg = null;

    function openTab(id, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'game') setTimeout(resizeCanvas, 100);
    }

    function resizeCanvas() {
        canvas.width = vp.clientWidth;
        canvas.height = vp.clientHeight;
        resetFog();
    }

    function resetFog() {
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = '#050b14';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function clearFog() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Movimento da n√©voa (Touch e Mouse)
    const handleMove = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        ctx.globalCompositeOperation = 'destination-out';
        ctx.beginPath();
        ctx.arc(x, y, 40, 0, Math.PI * 2);
        ctx.fill();
    };

    canvas.addEventListener('mousemove', (e) => { if(e.buttons > 0) handleMove(e); });
    canvas.addEventListener('touchmove', (e) => { handleMove(e); e.preventDefault(); }, {passive: false});

    // Tokens
    document.getElementById('tk-img').onchange = (e) => {
        currentTokenImg = URL.createObjectURL(e.target.files[0]);
    };

    vp.ondblclick = (e) => {
        const t = document.createElement('div');
        const size = document.getElementById('tk-size').value;
        t.className = `token ${size}`;
        if(currentTokenImg) t.style.backgroundImage = `url(${currentTokenImg})`;
        else t.style.backgroundColor = 'var(--neon)';

        const rect = vp.getBoundingClientRect();
        t.style.left = (e.clientX - rect.left - 20) + 'px';
        t.style.top = (e.clientY - rect.top - 20) + 'px';

        // Arrastar Token
        const drag = (ev) => {
            const moveX = (ev.clientX || ev.touches[0].clientX) - rect.left - 20;
            const moveY = (ev.clientY || ev.touches[0].clientY) - rect.top - 20;
            t.style.left = moveX + 'px';
            t.style.top = moveY + 'px';
        };

        t.addEventListener('mousedown', () => { document.addEventListener('mousemove', drag); });
        t.addEventListener('touchstart', () => { document.addEventListener('touchmove', drag); });
        window.addEventListener('mouseup', () => { document.removeEventListener('mousemove', drag); });
        window.addEventListener('touchend', () => { document.removeEventListener('touchmove', drag); });

        t.oncontextmenu = (ev) => { ev.preventDefault(); t.remove(); };
        vp.appendChild(t);
    };
</script>
</body>
</html>
