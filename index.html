<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS VTT // ORDEAL RPG</title>
    <style>
        body { background: #050b14; color: #00b4d8; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; touch-action: none; }
        header { padding: 10px; border-bottom: 2px solid #00b4d8; background: #0a192f; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .main { display: flex; flex: 1; overflow: hidden; }
        .panel { width: 160px; background: #0a192f; padding: 10px; border-right: 1px solid #0077b6; font-size: 12px; z-index: 5; }
        .viewport { flex: 1; background: #000; position: relative; overflow: hidden; cursor: crosshair; }
        .log { width: 150px; background: #050b14; padding: 10px; border-left: 1px solid #0077b6; overflow-y: auto; font-size: 11px; }
        .stat { background: #050b14; padding: 5px; border: 1px solid #0077b6; margin-bottom: 10px; }
        button { background: #0d1b2a; color: #00b4d8; border: 1px solid #00b4d8; padding: 5px; cursor: pointer; width: 100%; margin-top: 5px; font-size: 10px; }
        input[type="number"] { width: 35px; background: #0d1b2a; color: #fff; border: 1px solid #00b4d8; }
        #map-img { pointer-events: none; user-select: none; max-width: 2000px; }
        .token { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #fff; position: absolute; cursor: grab; background-size: cover; z-index: 100; box-shadow: 0 0 10px #000; }
    </style>
</head>
<body>
    <header>
        <strong>NEXUS VTT // ORDEAL</strong>
        <input type="file" id="up" accept="image/*" style="font-size: 9px; width: 120px;">
    </header>
    <div class="main">
        <div class="panel">
            <div class="stat">
                ‚ù§Ô∏è PV: <span id="pv">10</span><br>‚ú® MN: <span id="mn">0</span><br>üõ°Ô∏è DF: <span id="df">10</span>
            </div>
            <label>CORPO: <input type="number" id="c" value="0" onchange="u()"></label><br>
            <label>MENTE: <input type="number" id="m" value="0" onchange="u()"></label><br>
            <label>ALMA : <input type="number" id="a" value="0" onchange="u()"></label>
            <button onclick="r(document.getElementById('c').value, 'Ataque')">‚öîÔ∏è ATACAR</button>
            <button onclick="r(document.getElementById('a').value, 'Poder')">üî• PODER</button>
            <hr>
            <small>Toque no mapa para criar Token</small>
        </div>
        <div class="viewport" id="vp">
            <img id="map-img" style="display:none">
        </div>
        <div class="log" id="l"><strong>üìú LOG</strong><hr></div>
    </div>
    <script>
        function u() {
            let c = parseInt(document.getElementById('c').value) || 0;
            let a = parseInt(document.getElementById('a').value) || 0;
            document.getElementById('pv').innerText = c + 10; 
            document.getElementById('mn').innerText = a * 2;  
            document.getElementById('df').innerText = 10 + c; 
        }
        function r(mod, n) {
            let d = Math.floor(Math.random() * 20) + 1;
            let t = d + parseInt(mod || 0);
            let txt = `${t} (d20:${d})`;
            let cl = d === 20 ? "#ffd700" : (d === 1 ? "#ff4d4d" : "#00b4d8");
            let p = document.createElement('div');
            p.style.color = cl; p.style.borderBottom = "1px solid #1a1a1a";
            p.innerText = `[${n}] ` + (d === 20 ? "‚≠ê " : (d === 1 ? "üíÄ " : "")) + txt;
            document.getElementById('l').prepend(p);
        }

        // Sistema de Mapa e Tokens
        const vp = document.getElementById('vp');
        document.getElementById('up').onchange = (e) => {
            const img = document.getElementById('map-img');
            img.src = URL.createObjectURL(e.target.files[0]);
            img.style.display = 'block';
        };

        vp.addEventListener('mousedown', (e) => {
            if(e.target === vp || e.target.id === 'map-img') {
                createToken(e.offsetX, e.offsetY);
            }
        });

        function createToken(x, y) {
            const t = document.createElement('div');
            t.className = 'token';
            t.style.left = (x - 20) + 'px';
            t.style.top = (y - 20) + 'px';
            t.style.backgroundColor = 'hsl(' + Math.random() * 360 + ', 70%, 50%)';
            
            let isDragging = false;
            t.addEventListener('mousedown', () => isDragging = true);
            window.addEventListener('mousemove', (e) => {
                if(isDragging) {
                    t.style.left = (e.clientX - vp.offsetLeft - 20) + 'px';
                    t.style.top = (e.clientY - vp.offsetTop - 20) + 'px';
                }
            });
            window.addEventListener('mouseup', () => isDragging = false);
            t.addEventListener('dblclick', () => t.remove()); // Duplo clique para apagar
            vp.appendChild(t);
        }
    </script>
</body>
</html>
<small id="msg" style="text-align:center">Toque no bot√£o superior para<br>escolher o mapa da galeria</small>
            <img id="img" style="display:none">
        </div>
        <div class="log" id="l"><strong>üìú LOG</strong><hr></div>
    </div>
    <script>
        function u() {
            let c = parseInt(document.getElementById('c').value) || 0;
            let a = parseInt(document.getElementById('a').value) || 0;
            // Regras do Guia: PV = Corpo+10 | Mana = Alma*2 | Defesa = 10+Corpo
            document.getElementById('pv').innerText = c + 10; 
            document.getElementById('mn').innerText = a * 2;  
            document.getElementById('df').innerText = 10 + c; 
        }
        function r(mod, n) {
            let d = Math.floor(Math.random() * 20) + 1; // Sistema d20
            let t = d + parseInt(mod || 0);
            let txt = `${t} (d20:${d})`;
            let cl = "#00b4d8";
            if (d === 20) { txt = "‚≠ê CR√çTICO! " + txt; cl = "#ffd700"; } 
            if (d === 1) { txt = "üíÄ FALHA! " + txt; cl = "#ff4d4d"; }    
            let p = document.createElement('div');
            p.style.color = cl; p.style.borderBottom = "1px solid #1a1a1a";
            p.innerText = `[${n}] ` + txt; document.getElementById('l').prepend(p);
        }
        document.getElementById('up').onchange = (e) => {
            document.getElementById('img').src = URL.createObjectURL(e.target.files[0]);
            document.getElementById('img').style.display = 'block';
            document.getElementById('msg').style.display = 'none';
        };
    </script>
</body>
</html>
